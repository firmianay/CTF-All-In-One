# 1.5.4 Windows PE

Windows Preinstallation Environment（Windows PE）是一个简化版 Windows 系统，通常用来 `安装、部署、修复桌面版 Windows ` (划重点)，功能不如桌面版那么多，但是还是有不少的, Windows PE 可以：

- 在安装 Windows 前设置你的硬盘。
- 使用来自网络或本地驱动器的应用或脚本安装 Windows。
- 捕获和应用 Windows 映像。
- 在 Windows 操作系统不运行时，对它进行修改。
- 设置自动恢复工具。
- 从不可启动的设备中恢复数据。
- 添加自己的自定义外壳程序或 GUI 来使此类任务自动化。

## 硬件要求

相比于桌面版 Windows ，运行 Windows PE 要求低得多，大约如下：

- 无需硬盘，可以完全加载在内存中；
- 最低只需 500MB 内存，（如果添加了驱动程序、程序包或应用，占用内存会变大）
- 若要直接从内存启动 Windows PE（也称为 RAM 磁盘启动），必须提供一个可以容纳整个 Windows PE (WIM) 映像的连续的物理内存 (RAM) 部分。若要优化内存使用，制造商应确保其固件将内存位置保留在了物理内存地址空间的开头或末尾处。

## 支持的 Windows 功能

Windows PE 支持的 Windows 功能有：

- 批处理文件和脚本，包括对 Windows 脚本主机 (WSH) 和 ActiveX 数据对象 (ADO) 的支持，以及对 PowerShell 的选择支持。
- 应用程序，包括 Win32 应用程序编程接口 (API)，以及对 HTML 应用程序 (HTA) 的选择支持。
- 驱动程序，包括一组用于运行网络、图形和大容量存储设备的通用驱动程序。
- 映像捕获和服务，包括部署映像服务和管理 (DISM)。
- 网络，包括通过 LAN 使用 TCP/IP 和 TCP/IP 上的 NetBIOS 连接到文件服务器。
- 存储，包括 NTFS、DiskPart 和 BCDBoot。
- 安全工具，包括对 BitLocker 和受信任的平台模块 (TPM)、安全启动以及其他工具的选择支持。
- Hyper-V，包括 VHD 文件、鼠标集成、大容量存储以及允许在虚拟机监控程序中运行 Windows PE 的网络驱动程序。

32 位版本的 Windows PE 可以启动 32 位 UEFI 电脑和 BIOS 电脑以及 64 位 BIOS 电脑。
64 位版本的 Windows PE 可以启动 64 位 UEFI 电脑和 BIOS 电脑。

## 限制

Windows PE 并不是通用操作系统。它可能不会用于除部署和恢复之外的任何目的。不应该将它用作瘦客户端或嵌入式操作系统。其他 Microsoft 产品（例如 Windows Embedded CE）可以用于这些目的。

为防止将 Windows PE 作为生产操作系统使用，在连续使用 72 小时后，它将自动停止运行外壳程序并重新启动。在此期间，Windows PE 无法配置。

当 Windows PE 重新启动时，将丢失所有更改，包括对驱动程序、驱动器号和 Windows PE 注册表所做的更改。若要做出持久更改，请参阅 [WinPE：装载和自定义](https://msdn.microsoft.com/zh-cn/library/windows/hardware/dn938390(v=vs.85).aspx)。

默认 Windows PE 安装使用 FAT32 文件格式，该格式提出其自己的限制，包括最大 4GB 文件大小和最大 32GB 驱动器大小。若要了解详细信息，请参阅 [WinPE：将单个 USB 密钥用于 WinPE 和 WIM 文件 (.wim)](https://msdn.microsoft.com/zh-cn/library/windows/hardware/mt604742(v=vs.85).aspx)。

Windows PE 不支持一下任何操作：

- 使用文件服务器或终端服务器。
- 加入网络域。
- 从 IPv6 网络上的 Windows PE 连接到 IPv4 网络。
- 远程桌面。
- 从 .MSI 安装文件。
- 从包含非英文字符的路径启动。
- 在 32 位版本的 Windows PE 上运行 64 位应用。
- 通过 DISM 添加已捆绑应用程序包（.appxbundle 程序包）。

## 碎碎念

作为挨折腾电脑的理工科童鞋，之前装系统的时候是笃定了用微软原版系统的，因为不放心百度得到的 Windows PE ，安装之后有各种各样的小东西，有精神洁癖是在受不鸟，但是不得不承认 Windows PE 能在安装系统之前做很多准备工作，包括但不限于硬盘分区、数据备份……
微软官方给出了 Windows PE 的制作方法，详细信息请参阅[下载 WinPE](https://msdn.microsoft.com/zh-cn/library/windows/hardware/dn898560(v=vs.85).aspx)
受限于国内的网络环境，和实际操作的种种复杂性，并不太推荐自行制作 Windows PE ，推荐一个比较好使的 [微PE工具箱](http://www.wepe.com.cn/)(PS: 推荐微PE仅仅是笔者使用感受较好，安全性请自行考量)

## 参考链接

[本文摘自MSDN](https://msdn.microsoft.com/zh-cn/library/windows/hardware/dn938389(v=vs.85).aspx)

[IT之家学院：手把手教你制作WinRE](https://www.ithome.com/html/win10/319069.htm)